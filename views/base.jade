doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title
      block title
        | Cause &amp; Effect |&nbsp;
      | Causemap

    block meta-tags
      meta(
        name='description',
        content='Real-life situations linked by cause and effect'
      )

    link(rel='alternate icon', type='image/png', href='/images/favicon.png')
    link(href='https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css', rel='stylesheet')
    link(href='http://cdnjs.cloudflare.com/ajax/libs/angularjs-toaster/0.4.4/toaster.css', rel='stylesheet')

    // Bootstrap
    link(href='/fonts/cm-streamline/styles.css', rel='stylesheet')
    link(href='/stylesheets/site.css', rel='stylesheet')

    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media
    // queries WARNING: Respond.js doesn't work if you view the page via
    // file://
    //if lt IE 9
       script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
       script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')

    script(src='/lib/moment/min/moment.min.js')
    script(src='/lib/pouchdb/dist/pouchdb.min.js')
    script(src='/javascripts/pouchdb-update.min.js')
    script(src='/lib/pouchdb-authentication/dist/pouchdb.authentication.min.js')
    script(src='https://ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular.min.js')
    script(src='http://code.angularjs.org/1.2.0/angular-animate.min.js')
    script(src='/lib/lodash/dist/lodash.min.js')
    script(src='/lib/elasticsearch/elasticsearch.angular.min.js')
    script(src='/javascripts/site.js')

    script.
      (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
      for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
      mixpanel.init("bc42d283aff847567e615478b2408778");

  body(ng-app='causemap', class='#{ body_class }')
    .navbar.navbar-default.navbar-static-top(role='navigation')
      .container
        .row
          .navbar-header.col-md-2
            button.navbar-toggle.collapsed(
              type='button',
              data-toggle='collapse',
              data-target='#navbar-collapse'
            )
              span.sr-only Toggle Navigation
              span.icon-bar
              span.icon-bar
              span.icon-bar

            .navbar-brand
              a(href='/').branding
                i.cm-logo
                | &nbsp;
                | Causemap

          #navbar-collapse.collapse.navbar-collapse
            .navbar-form.navbar-left(role='search')
              form(action='/', method='get')
                .form-group
                  if query && query.search
                    input.form-control(
                      type='search',
                      name='search',
                      value=query.search,
                      placeholder='Search'
                    )
                  else
                    input.form-control(
                      type='search',
                      name='search',
                      placeholder='Search'
                    )

            ul.nav.navbar-nav.navbar-right
              li(ng-controller='SituationsCtrl')
                a(
                  data-toggle='modal',
                  data-target='#add-situation-modal'
                )
                  i.glyphicon.glyphicon-plus &nbsp;
                  | Add a Situation

              li(
                ng-controller='AuthCtrl',
                ng-if='!session.userCtx.name',
                ng-cloak
              )
                a(
                  data-toggle='modal',
                  data-target='#login-signup-modal',
                  href=''
                )
                  i.glyphicon.glyphicon-login &nbsp;
                  | Login or Sign-Up

              li.dropdown.pull-right(ng-if='session.userCtx.name', ng-cloak)
                a(data-toggle='dropdown')
                  i.glyphicon.glyphicon-user &nbsp;
                  | {{ session.userCtx.name }}
                ul.dropdown-menu(role='menu')
                  li
                    a(ng-click='logout()') Logout


    block content

    #footer.text-muted
      .container
        .row
          .col-md-12
            :markdown 
              Get updates on [twitter](http://twitter.com/causemap) or [facebook](https://www.facebook.com/causemap) and make requests on [reddit](http://www.reddit.com/r/causemap)

    #add-situation-modal.modal.fade
      .modal-dialog
        .modal-content
          form(ng-submit='add_situation()')
            .modal-body
              // h3 What's the situation?
              .form-group
                label What's the situation?
                input.form-control(
                  ng-model='new_situation_name',
                  placeholder='eg. Germany won the 2014 World Cup'
                )
            .modal-footer
              a.btn.btn-default(data-dismiss='modal') Cancel
              button.btn.btn-primary(type='submit') Add

    #login-signup-modal.modal.fade
      .modal-dialog.modal-sm
        .modal-content
          form(ng-submit='loginSignup()')
            .modal-body
              .form-group
                .input-group
                  span.input-group-addon
                    i.fa.fa-user.fa-fw
                  input.form-control(
                    type='text',
                    placeholder='Username',
                    ng-model='auth.username'
                  )

              .form-group
                .input-group
                  span.input-group-addon
                    i.fa.fa-key.fa-fw
                  input.form-control(
                    type='password',
                    placeholder='Password',
                    ng-model='auth.password'
                  )

              .form-group
                .radio
                  label
                    input#returning-user(
                      type='radio',
                      name='user_has_account',
                      ng-value='true',
                      ng-model='auth.user_has_account'
                    )
                    | I am a returning user
                .radio
                  label
                    input#new-user(
                      type='radio',
                      name='user_has_account',
                      ng-value='false',
                      ng-model='auth.user_has_account'
                    )
                    | I am a new user

            .modal-footer
              button.btn.btn-primary.btn-block(
                type='submit',
                data-loading-text='Logging in'
              ) Login

    // jQuery (necessary for Bootstrap's JavaScript plugins)
    script(
      src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
    script(src='http://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.2/js/toastr.min.js')
    script(src='/lib/masonry/dist/masonry.pkgd.min.js')
    script(src='/lib/imagesloaded/imagesloaded.js')
    script.
      $('.display-image.loading').imagesLoaded().progress(function(
        instance,
        image
      ){
        $(image.img).parent().removeClass('loading');
      })

      $('time.from-now').each(function(){
        this.innerHTML = 'Created ';
        this.innerHTML += moment(this.getAttribute('datetime')).fromNow()
      })

      toastr.options = {
        "positionClass": "toast-bottom-right"
      }

    // Include all compiled plugins (below), or include individual files as
    // needed
    script(src='/lib/bootstrap/dist/js/bootstrap.min.js')
    script(src='/lib/marked/lib/marked.js')

    script.
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-55037543-1', 'auto');
      ga('send', 'pageview');

    block body-js
